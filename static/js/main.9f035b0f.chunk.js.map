{"version":3,"sources":["config.ts","types/currentlyPlayingState.ts","img/banner.png","components/MetaTags.tsx","img/banner-dark.png","img/logo.png","components/Navigation.tsx","utils.ts","hooks/useSmoothProgress.ts","img/spotify-logo-round.png","components/Player.tsx","hooks/useCurrentlyPlayingSong.ts","hooks/useLyrics.ts","api/index.ts","hooks/useThemeState.ts","hooks/useTokenRefresh.ts","hooks/useUser.ts","pages/About/index.tsx","pages/LyricsView/Advertisement.tsx","pages/LyricsView/Error.tsx","pages/LyricsView/Loading.tsx","pages/LyricsView/NoTrackPlaying.tsx","pages/LyricsView/LyricsDisplay.tsx","pages/LyricsView/TrackPlaying.tsx","pages/LyricsView/Welcome.tsx","pages/LyricsView/index.tsx","pages/NotFound/index.tsx","pages/SpotifyAuthorization/index.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["config","api","root","process","spotify_authentication_route","siteUrl","client","basename","REACT_APP_BASENAME","trackCheckDelaySeconds","rawValue","intValue","parseInt","isNaN","Math","max","getTrackCheckDelaySeconds","PlayingStates","MetaTags","titlePrefix","description","route","children","title","useMetaTags","charset","lang","links","rel","href","type","openGraph","image","BannerImage","site_name","navbarLinks","useStyles","makeStyles","theme","appBar","backgroundColor","palette","background","paper","toolbar","padding","logo","cursor","link","textDecoration","color","text","secondary","primary","activeLink","userIcon","width","height","grow","flexGrow","Navigation","user","onLogout","onThemeToggle","isDarkMode","classes","currentPath","usePath","useTheme","showFullLogo","useMediaQuery","breakpoints","up","goTo","location","event","preventDefault","navigate","AppBar","position","className","Container","maxWidth","Toolbar","Link","onClick","src","BannerImageDark","alt","LogoImage","Object","keys","map","path","Box","display","ml","Typography","variant","IconButton","window","confirm","Avatar","display_name","undefined","images","length","url","substring","responseError","request","hide","cogoToast","error","JSON","parse","responseText","message","heading","hideAfter","formatMilliseconds","milliseconds","totalSeconds","floor","minutes","seconds","toString","padStart","useSmoothProgress","progressMs","duration","isPlaying","token","smoothingDelay","useState","progress","setProgress","userSlidingProgress","setUserSlidingProgress","smoothProgressTimer","setSmoothProgressTimer","useEffect","clearTimeout","setInterval","value","min","onUserFinishedSliding","newProgress","Array","isArray","spotifyApi","SpotifyWebApi","setAccessToken","seek","catch","e","onUserSlide","top","bottom","paddingTop","paddingBottom","playerWrapper","gridTemplateColumns","gridColumnGap","down","songWrapper","gridTemplateRows","songAlbumArtWrapper","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","songAlbumArt","songDetail","whiteSpace","overflow","textOverflow","timeControl","controlsWrapper","alignItems","justifyContent","control","sliderWrapper","slider","Player","currentlyPlayingSong","albumArt","currentlyPlayingObject","item","album","name","artist","artists","a","join","durationMs","duration_ms","progress_ms","is_playing","currently_playing_type","SpotifyLogoRoundImage","smoothedProgressMs","onPlayPauseToggle","pause","play","fontSize","skipToPrevious","htmlColor","skipToNext","Slider","valueLabelDisplay","onChangeCommitted","onChange","useCurrentlyPlayingSong","invalidateToken","state","Loading","currentlyPlaying","setCurrentlyPlaying","checkSongTimeout","setCheckSongTimeout","updateCurrentPlaying","tokenValue","getMyCurrentPlayingTrack","then","NotPlaying","Playing","Paused","status","info","Error","timeToRefresh","setTimeout","intervalCheck","getLyricsPromiseCache","useLyrics","lyrics","setLyrics","hasSongChanged","id","currentlyPlayingItemId","lyricsAreEmpty","plainLyrics","syncedLyrics","trackNameWithReplacements","replace","trim","getLyricsPromiseCacheKey","stringify","x","getLyricsPromise","albumName","parameters","URLSearchParams","append","fetch","Config","r","json","getLyrics","didCancel","getLyricsResult","processPromise","localStorageKey","getTheme","isDark","createMuiTheme","main","green","useThemeState","darkMode","setDarkMode","useMemo","rawState","localStorage","getItem","toggleTheme","m","newState","setItem","removeItem","darkModeEnabled","useTokenRefresh","onNewToken","clearToken","tokenTimeout","setTokenTimeout","expiry","getTime","Date","credentials","newToken","access_token","expires_at","warn","useUser","setUser","getMe","newUser","err","console","About","style","margin","align","gutterBottom","mt","Advertisement","textAlign","CircularProgress","size","NoTrackPlaying","calculateLyricsState","lyricsDetails","syncEnabled","paused","progressSeconds","before","highlighted","after","passedLyricsAndCurrent","filter","timestamp","passedLyrics","slice","currentLyrics","upcomingLyrics","content","highlightedLyricsWrapper","marginTop","marginBottom","highlightedLyrics","fontWeight","right","LyricsDisplay","lyricsRef","useRef","searchInputRef","highlightedRef","search","setSearch","searchShown","setSearchShown","setSyncEnabled","Infinity","isSyncingPossible","current","instance","MarkJS","unmark","mark","focus","element","scrollIntoView","behavior","block","inline","lyricsState","toggleSearchShown","s","mb","TextField","currentTarget","InputProps","endAdornment","InputAdornment","edge","label","placeholder","disabled","component","ref","attribution","TrackPlaying","lyricDetails","Welcome","Button","startIcon","LyricsView","NotFound","SpotifyAuthorization","params","substr","accessToken","get","expiresAt","App","setToken","method","setBasepath","routes","routeResult","useRoutes","useRedirect","ThemeProvider","CssBaseline","py","Boolean","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.9f035b0f.chunk.js","sourcesContent":["const getTrackCheckDelaySeconds = () => {\n  const rawValue = process.env.REACT_APP_TRACK_CHECK_DELAY_SECONDS ?? \"\";\n  if (rawValue === \"\") {\n    return 1;\n  }\n  const intValue = parseInt(rawValue);\n  if (isNaN(intValue)) {\n    return 1;\n  }\n  return Math.max(intValue, 1);\n};\n\nconst config = {\n  api: {\n    root: process.env.REACT_APP_API_ROOT ? process.env.REACT_APP_API_ROOT : window.location.origin,\n    spotify_authentication_route: \"/api/spotify/authenticate\"\n  },\n  siteUrl: \"https://spotify-lyrics-viewer.nitratine.net\",\n  client: {\n    basename: process.env.REACT_APP_BASENAME,\n    trackCheckDelaySeconds: getTrackCheckDelaySeconds()\n  }\n};\n\nexport default config;\n","export enum PlayingStates {\n  Playing,\n  NotPlaying,\n  Loading,\n  Error,\n  Paused\n}\n\nexport interface PlayingStatePlaying {\n  state: PlayingStates.Playing;\n  currentlyPlayingObject: SpotifyApi.CurrentlyPlayingObject;\n}\n\nexport interface PlayingStatePaused {\n  state: PlayingStates.Paused;\n  currentlyPlayingObject: SpotifyApi.CurrentlyPlayingObject;\n}\n\ninterface PlayingStateNotPlaying {\n  state: PlayingStates.NotPlaying;\n  currentlyPlayingObject: null;\n}\n\ninterface PlayingStateLoading {\n  state: PlayingStates.Loading;\n  currentlyPlayingObject: null;\n}\n\ninterface PlayingStateError {\n  state: PlayingStates.Error;\n  currentlyPlayingObject: null;\n}\n\nexport type CurrentlyPlayingState =\n  | PlayingStatePlaying\n  | PlayingStatePaused\n  | PlayingStateNotPlaying\n  | PlayingStateLoading\n  | PlayingStateError;\n","export default __webpack_public_path__ + \"static/media/banner.c8f2c7de.png\";","import React from \"react\";\nimport useMetaTags from \"react-metatags-hook\";\nimport config from \"../config\";\nimport BannerImage from \"../img/banner.png\";\n\ninterface IProps {\n  titlePrefix?: string;\n  description: string;\n  route: string;\n}\n\nconst MetaTags: React.FunctionComponent<React.PropsWithChildren<IProps>> = ({\n  titlePrefix,\n  description,\n  route,\n  children\n}) => {\n  const title = (titlePrefix ?? \"\") + \"Spotify Lyrics Viewer\";\n  useMetaTags({\n    title,\n    description,\n    charset: \"utf-8\",\n    lang: \"en\",\n    links: [\n      { rel: \"canonical\", href: config.siteUrl + route },\n      { rel: \"icon\", type: \"image/ico\", href: \"/favicon.ico\" },\n      { rel: \"apple-touch-icon\", type: \"image/png\", href: \"/logo.png\" }\n    ],\n    openGraph: {\n      title,\n      image: config.siteUrl + BannerImage,\n      site_name: \"Spotify Lyrics Viewer\"\n    }\n  });\n\n  return <>{children}</>;\n};\n\nexport default MetaTags;\n","export default __webpack_public_path__ + \"static/media/banner-dark.928b88b7.png\";","export default __webpack_public_path__ + \"static/media/logo.175a6cf7.png\";","import {\n  AppBar,\n  Avatar,\n  Box,\n  Container,\n  IconButton,\n  Link,\n  Toolbar,\n  Typography,\n  makeStyles,\n  useMediaQuery,\n  useTheme\n} from \"@material-ui/core\";\nimport AccountCircleIcon from \"@material-ui/icons/AccountCircle\";\nimport DarkModeIcon from \"@material-ui/icons/Brightness4\";\nimport LightModeIcon from \"@material-ui/icons/Brightness7\";\nimport GitHubIcon from \"@material-ui/icons/GitHub\";\nimport { navigate, usePath } from \"hookrouter\";\nimport React from \"react\";\nimport BannerImageDark from \"../img/banner-dark.png\";\nimport BannerImage from \"../img/banner.png\";\nimport LogoImage from \"../img/logo.png\";\n\nconst navbarLinks: { [key: string]: string } = {\n  \"/\": \"Home\",\n  \"/about\": \"About\"\n};\n\ninterface IProps {\n  user: SpotifyApi.UserObjectPrivate | null;\n  onLogout: () => void;\n  onThemeToggle: () => void;\n  isDarkMode: boolean;\n}\n\nconst Navigation: React.FunctionComponent<IProps> = ({\n  user,\n  onLogout,\n  onThemeToggle,\n  isDarkMode\n}) => {\n  const classes = useStyles();\n  const currentPath = usePath();\n  const theme = useTheme();\n\n  const showFullLogo = useMediaQuery(theme.breakpoints.up(\"sm\"));\n\n  const goTo = (location: string) => (event: React.MouseEvent<HTMLAnchorElement, MouseEvent>) => {\n    event.preventDefault();\n    navigate(location);\n  };\n\n  const onUserIconClick = () => {\n    if (user === null) {\n      navigate(\"/spotify-authorization\");\n    } else {\n      const answer = window.confirm(\"Are you sure you want to logout?\");\n      if (answer) {\n        onLogout();\n      }\n    }\n  };\n\n  return (\n    <AppBar position=\"static\" className={classes.appBar}>\n      <Container maxWidth=\"md\">\n        <Toolbar className={classes.toolbar}>\n          <Link href=\"/\" onClick={goTo(\"/\")}>\n            {showFullLogo ? (\n              <img\n                src={isDarkMode ? BannerImageDark : BannerImage}\n                height=\"30\"\n                alt=\"Spotify Lyrics Viewer Banner\"\n                className={classes.logo}\n              />\n            ) : (\n              <img\n                src={LogoImage}\n                height=\"30\"\n                alt=\"Spotify Lyrics Viewer Logo\"\n                className={classes.logo}\n              />\n            )}\n          </Link>\n\n          {Object.keys(navbarLinks).map(path => (\n            <Box key={path} display=\"inline\" ml={2}>\n              <Link\n                href={path}\n                onClick={goTo(path)}\n                className={`${classes.link} ${currentPath === path ? classes.activeLink : \"\"}`}\n              >\n                <Typography variant=\"body1\">{navbarLinks[path]}</Typography>\n              </Link>\n            </Box>\n          ))}\n\n          <div className={classes.grow} />\n\n          <Link href=\"https://github.com/brentvollebregt/spotify-lyrics-viewer\">\n            <IconButton>\n              <GitHubIcon />\n            </IconButton>\n          </Link>\n\n          <IconButton onClick={onThemeToggle}>\n            {isDarkMode ? <LightModeIcon /> : <DarkModeIcon />}\n          </IconButton>\n\n          <IconButton onClick={onUserIconClick}>\n            {user !== null ? (\n              <Avatar\n                alt={user.display_name + \" Logo\"}\n                src={\n                  user.images !== undefined && user.images.length > 0\n                    ? user.images[0].url\n                    : undefined\n                }\n                className={classes.userIcon}\n              >\n                {user.display_name?.substring(0, 1)}\n              </Avatar>\n            ) : (\n              <AccountCircleIcon />\n            )}\n          </IconButton>\n        </Toolbar>\n      </Container>\n    </AppBar>\n  );\n};\n\nconst useStyles = makeStyles(theme => ({\n  appBar: {\n    backgroundColor: theme.palette.background.paper\n  },\n  toolbar: {\n    padding: 0\n  },\n  logo: {\n    cursor: \"pointer\"\n  },\n  link: {\n    textDecoration: \"none\",\n    color: theme.palette.text.secondary,\n    \"&:hover\": {\n      color: theme.palette.text.primary,\n      textDecoration: \"none\"\n    }\n  },\n  activeLink: {\n    color: theme.palette.text.primary\n  },\n  userIcon: {\n    width: 30,\n    height: 30\n  },\n  // Utils\n  grow: {\n    flexGrow: 1\n  }\n}));\n\nexport default Navigation;\n","import cogoToast from \"cogo-toast\";\n\nexport const responseError = (title: string, request: XMLHttpRequest) => {\n  const { hide } = cogoToast.error(JSON.parse(request.responseText).error.message, {\n    position: \"bottom-center\",\n    heading: title,\n    hideAfter: 20,\n    onClick: () => hide !== undefined && hide()\n  });\n};\n\nexport const formatMilliseconds = (milliseconds: number) => {\n  // Convert milliseconds to seconds\n  const totalSeconds = Math.floor(milliseconds / 1000);\n\n  // Calculate minutes and seconds\n  const minutes = Math.floor(totalSeconds / 60);\n  const seconds = totalSeconds % 60;\n\n  // Format the output to \"minutes:seconds\"\n  // Pad the seconds with a leading zero if it's less than 10\n  return `${minutes}:${seconds.toString().padStart(2, \"0\")}`;\n};\n","import { useEffect, useState } from \"react\";\nimport SpotifyWebApi from \"spotify-web-api-js\";\nimport { IToken } from \"../types/token\";\nimport { responseError } from \"../utils\";\n\nconst useSmoothProgress = (\n  progressMs: number,\n  duration: number,\n  isPlaying: boolean,\n  token: IToken | null,\n  smoothingDelay: number = 500\n) => {\n  const [progress, setProgress] = useState(0);\n  const [userSlidingProgress, setUserSlidingProgress] = useState(false);\n  const [smoothProgressTimer, setSmoothProgressTimer] = useState<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    // Use the current progress when the user is not sliding\n    if (!userSlidingProgress) {\n      setProgress(progressMs);\n    }\n  }, [userSlidingProgress, progressMs]);\n\n  useEffect(() => {\n    // Smoother progress bar\n    if (smoothProgressTimer !== null) {\n      clearTimeout(smoothProgressTimer);\n    }\n\n    setSmoothProgressTimer(\n      setInterval(() => {\n        if (!userSlidingProgress && isPlaying) {\n          setProgress(value => Math.min(value + smoothingDelay, duration));\n        }\n      }, smoothingDelay)\n    );\n\n    return () => {\n      if (smoothProgressTimer !== null) {\n        clearTimeout(smoothProgressTimer);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [userSlidingProgress, isPlaying, duration]);\n\n  const onUserFinishedSliding = (event: React.ChangeEvent<{}>, value: number | number[]) => {\n    const newProgress = Array.isArray(value) ? value[0] : value;\n    setProgress(newProgress);\n\n    setUserSlidingProgress(false);\n    if (token !== null) {\n      const spotifyApi = new SpotifyWebApi();\n      spotifyApi.setAccessToken(token.value);\n      spotifyApi.seek(progress).catch(e => responseError(\"Failed to Seek\", e));\n    }\n  };\n  const onUserSlide = (event: React.ChangeEvent<{}>, value: number | number[]) => {\n    setUserSlidingProgress(true);\n    setProgress(Array.isArray(value) ? value[0] : value);\n  };\n\n  return { onUserFinishedSliding, onUserSlide, progress };\n};\n\nexport default useSmoothProgress;\n","export default __webpack_public_path__ + \"static/media/spotify-logo-round.7000afed.png\";","import { AppBar, Box, Container, Slider, makeStyles } from \"@material-ui/core\";\nimport PauseCircleFilledIcon from \"@material-ui/icons/PauseCircleFilled\";\nimport PlayCircleFilledIcon from \"@material-ui/icons/PlayCircleFilled\";\nimport SkipNextIcon from \"@material-ui/icons/SkipNext\";\nimport SkipPreviousIcon from \"@material-ui/icons/SkipPrevious\";\nimport React from \"react\";\nimport SpotifyWebApi from \"spotify-web-api-js\";\nimport useSmoothProgress from \"../hooks/useSmoothProgress\";\nimport SpotifyLogoRoundImage from \"../img/spotify-logo-round.png\";\nimport { CurrentlyPlayingState } from \"../types/currentlyPlayingState\";\nimport { IToken } from \"../types/token\";\nimport { formatMilliseconds, responseError } from \"../utils\";\n\nconst placeholder1PxImage =\n  \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mO8+x8AAr8B3gzOjaQAAAAASUVORK5CYII=\"; // Generated using https://png-pixel.com/\n\ninterface PlayerProps {\n  currentlyPlayingSong: CurrentlyPlayingState;\n  token: IToken | null;\n}\n\nconst Player: React.FC<PlayerProps> = ({ currentlyPlayingSong, token }) => {\n  const classes = useStyles();\n\n  let albumArt = currentlyPlayingSong.currentlyPlayingObject?.item?.album.images[0].url;\n  let title = currentlyPlayingSong.currentlyPlayingObject?.item?.name ?? \"---\";\n  let artist =\n    currentlyPlayingSong.currentlyPlayingObject?.item?.artists.map(a => a.name).join(\", \") ?? \"---\";\n  let durationMs = currentlyPlayingSong.currentlyPlayingObject?.item?.duration_ms ?? 0;\n  const progressMs = currentlyPlayingSong.currentlyPlayingObject?.progress_ms ?? 0;\n  const isPlaying = currentlyPlayingSong.currentlyPlayingObject?.is_playing ?? false;\n\n  if (currentlyPlayingSong?.currentlyPlayingObject?.currently_playing_type === \"ad\") {\n    albumArt = SpotifyLogoRoundImage;\n    title = \"Advertisement\";\n    artist = \"Spotify\";\n    durationMs = Math.max(progressMs, 30 * 1000); // Typically 30s but allow for something over\n  }\n\n  const {\n    onUserFinishedSliding,\n    onUserSlide,\n    progress: smoothedProgressMs\n  } = useSmoothProgress(progressMs, durationMs, isPlaying, token);\n\n  const onSkipPrevious = () => {\n    if (token) {\n      const spotifyApi = new SpotifyWebApi();\n      spotifyApi.setAccessToken(token.value);\n      spotifyApi.skipToPrevious().catch(e => responseError(\"Failed to Skip to Previous Song\", e));\n    }\n  };\n  const onSkipNext = () => {\n    if (token) {\n      const spotifyApi = new SpotifyWebApi();\n      spotifyApi.setAccessToken(token.value);\n      spotifyApi.skipToNext().catch(e => {\n        responseError(\"Failed to Skip to Next Song\", e);\n      });\n    }\n  };\n  const onPlayPauseToggle = () => {\n    if (token) {\n      const spotifyApi = new SpotifyWebApi();\n      spotifyApi.setAccessToken(token.value);\n      if (isPlaying) {\n        spotifyApi.pause().catch(e => responseError(\"Failed to Pause\", e));\n      } else {\n        spotifyApi.play().catch(e => responseError(\"Failed to Play\", e));\n      }\n    }\n  };\n\n  return (\n    <AppBar position=\"static\" color=\"primary\" className={classes.appBar}>\n      <Container maxWidth=\"md\">\n        <div className={classes.playerWrapper}>\n          <div className={classes.songWrapper}>\n            <div className={classes.songAlbumArtWrapper}>\n              <img\n                src={albumArt ?? placeholder1PxImage}\n                className={classes.songAlbumArt}\n                alt={`Album art for current song`}\n              />\n            </div>\n            <div className={classes.songDetail} title={title}>\n              {title}\n            </div>\n            <div className={classes.songDetail} title={artist}>\n              {artist}\n            </div>\n          </div>\n\n          <div className={classes.controlsWrapper}>\n            <SkipPreviousIcon\n              fontSize=\"large\"\n              className={classes.control}\n              onClick={onSkipPrevious}\n            />\n\n            {isPlaying ? (\n              <PauseCircleFilledIcon\n                fontSize=\"large\"\n                htmlColor=\"black\"\n                onClick={onPlayPauseToggle}\n                className={classes.control}\n              />\n            ) : (\n              <PlayCircleFilledIcon\n                fontSize=\"large\"\n                htmlColor=\"black\"\n                onClick={onPlayPauseToggle}\n                className={classes.control}\n              />\n            )}\n\n            <SkipNextIcon fontSize=\"large\" className={classes.control} onClick={onSkipNext} />\n          </div>\n\n          <Box display=\"inline-flex\" alignItems=\"center\" className={classes.sliderWrapper}>\n            <span className={classes.timeControl}>{formatMilliseconds(smoothedProgressMs)}</span>\n\n            <Slider\n              valueLabelDisplay=\"off\"\n              value={smoothedProgressMs}\n              min={0}\n              max={durationMs}\n              onChangeCommitted={onUserFinishedSliding}\n              onChange={onUserSlide}\n              className={classes.slider}\n            />\n            <span className={classes.timeControl}>{formatMilliseconds(durationMs)}</span>\n          </Box>\n        </div>\n      </Container>\n    </AppBar>\n  );\n};\n\nconst useStyles = makeStyles(theme => ({\n  appBar: {\n    backgroundColor: theme.palette.background.paper,\n    top: \"auto\",\n    bottom: 0,\n    background: \"#f8f9fa\",\n    paddingTop: 6,\n    paddingBottom: 6\n  },\n  playerWrapper: {\n    display: \"grid\",\n    gridTemplateColumns: \"auto auto 1fr\",\n    gridColumnGap: 16,\n    [theme.breakpoints.down(\"xs\")]: {\n      gridTemplateColumns: \"auto auto\"\n    }\n  },\n  songWrapper: {\n    display: \"inline-grid\",\n    gridTemplateColumns: \"auto 1fr\",\n    gridTemplateRows: \"1fr 1fr\",\n    gridColumnGap: 5,\n    maxWidth: 250\n  },\n  songAlbumArtWrapper: {\n    gridColumnStart: 1,\n    gridColumnEnd: 2,\n    gridRowStart: 1,\n    gridRowEnd: 3\n  },\n  songAlbumArt: {\n    height: 40,\n    width: 40\n  },\n  songDetail: {\n    color: theme.palette.text.primary,\n    whiteSpace: \"nowrap\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\"\n  },\n  timeControl: {\n    color: theme.palette.text.primary,\n    whiteSpace: \"nowrap\",\n    textOverflow: \"ellipsis\"\n  },\n  controlsWrapper: {\n    display: \"inline-grid\",\n    gridTemplateColumns: \"auto auto auto\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  control: {\n    color: theme.palette.text.primary,\n    cursor: \"pointer\"\n  },\n  sliderWrapper: {\n    [theme.breakpoints.down(\"xs\")]: {\n      gridColumnStart: 1,\n      gridColumnEnd: 3\n    }\n  },\n  slider: {\n    [theme.breakpoints.down(\"xs\")]: {\n      padding: \"10px 0\"\n    },\n    marginLeft: 10,\n    marginRight: 10\n  }\n}));\n\nexport default Player;\n","import cogoToast from \"cogo-toast\";\nimport { useEffect, useState } from \"react\";\nimport SpotifyWebApi from \"spotify-web-api-js\";\nimport config from \"../config\";\nimport { CurrentlyPlayingState, PlayingStates } from \"../types/currentlyPlayingState\";\nimport { IToken } from \"../types/token\";\n\nconst useCurrentlyPlayingSong = (token: IToken | null, invalidateToken: () => void) => {\n  const [currentlyPlaying, setCurrentlyPlaying] = useState<CurrentlyPlayingState>({\n    state: PlayingStates.Loading,\n    currentlyPlayingObject: null\n  });\n  const [checkSongTimeout, setCheckSongTimeout] = useState<NodeJS.Timeout | null>(null);\n\n  const updateCurrentPlaying = (tokenValue: string) => {\n    const spotifyApi = new SpotifyWebApi();\n    spotifyApi.setAccessToken(tokenValue);\n    spotifyApi\n      .getMyCurrentPlayingTrack()\n      .then((currentlyPlayingObject: SpotifyApi.CurrentlyPlayingObject | \"\") => {\n        if (currentlyPlayingObject === \"\") {\n          setCurrentlyPlaying({ state: PlayingStates.NotPlaying, currentlyPlayingObject: null }); // HTTP 204 when no track is currently playing\n        } else {\n          const state: PlayingStates = currentlyPlayingObject.is_playing\n            ? PlayingStates.Playing\n            : PlayingStates.Paused;\n          setCurrentlyPlaying({\n            state,\n            currentlyPlayingObject: currentlyPlayingObject\n          });\n        }\n      })\n      .catch((request: XMLHttpRequest) => {\n        if (request.status === 401) {\n          invalidateToken();\n          const { hide } = cogoToast.info(\"You have been logged out\", {\n            position: \"bottom-center\",\n            heading: \"Token expired\",\n            hideAfter: 20,\n            onClick: () => hide !== undefined && hide()\n          });\n        } else {\n          setCurrentlyPlaying({ state: PlayingStates.Error, currentlyPlayingObject: null });\n          const { hide } = cogoToast.error(request.responseText, {\n            position: \"bottom-center\",\n            heading: \"Failed to Get Current Song\",\n            hideAfter: 20,\n            onClick: () => hide !== undefined && hide()\n          });\n        }\n      });\n  };\n\n  // Get currently playing song on load (when the token changes)\n  useEffect(() => {\n    if (token !== null) {\n      updateCurrentPlaying(token.value);\n    } else {\n      setCurrentlyPlaying({ state: PlayingStates.Loading, currentlyPlayingObject: null });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [token]);\n\n  // Setup a check for a new song at the end of the current song\n  useEffect(() => {\n    if (checkSongTimeout !== null) {\n      clearTimeout(checkSongTimeout);\n    }\n\n    if (\n      (currentlyPlaying.state === PlayingStates.Playing ||\n        currentlyPlaying.state === PlayingStates.Paused) &&\n      currentlyPlaying.currentlyPlayingObject.item !== null\n    ) {\n      const timeToRefresh =\n        currentlyPlaying.currentlyPlayingObject.item.duration_ms -\n        (currentlyPlaying.currentlyPlayingObject.progress_ms === null\n          ? 0\n          : currentlyPlaying.currentlyPlayingObject.progress_ms) +\n        500; // (duration - progress) - 500ms\n      setCheckSongTimeout(\n        setTimeout(() => {\n          if (token !== null) {\n            updateCurrentPlaying(token.value);\n          }\n        }, timeToRefresh)\n      );\n    }\n\n    return () => {\n      if (checkSongTimeout !== null) {\n        clearTimeout(checkSongTimeout);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentlyPlaying]);\n\n  // Setup timers to periodically check for a new song (in case someone skips)\n  useEffect(() => {\n    const intervalCheck = setInterval(() => {\n      if (token !== null) {\n        updateCurrentPlaying(token.value);\n      }\n    }, config.client.trackCheckDelaySeconds * 1000);\n\n    return () => clearTimeout(intervalCheck);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [token]);\n\n  return currentlyPlaying;\n};\n\nexport default useCurrentlyPlayingSong;\n","import { useEffect, useState } from \"react\";\nimport { IFoundLyrics } from \"../../../src/dto\";\nimport { getLyrics } from \"../api\";\nimport { CurrentlyPlayingState, PlayingStates } from \"../types/currentlyPlayingState\";\nimport { ITrackLyrics } from \"../types/trackLyrics\";\n\nconst getLyricsPromiseCache: Record<string, Promise<IFoundLyrics | null>> = {};\n\nconst useLyrics = (currentlyPlaying: CurrentlyPlayingState) => {\n  const [lyrics, setLyrics] = useState<ITrackLyrics | undefined>(undefined); // undefined = no lyrics yet, .lyrics=undefined = no lyrics exist\n\n  useEffect(() => {\n    // Get new lyrics when the current playing item changes\n    if (\n      (currentlyPlaying.state !== PlayingStates.Playing &&\n        currentlyPlaying.state !== PlayingStates.Paused) ||\n      currentlyPlaying.currentlyPlayingObject.item === null\n    ) {\n      setLyrics(undefined);\n    } else {\n      const hasSongChanged =\n        currentlyPlaying.currentlyPlayingObject.item.id !== lyrics?.currentlyPlayingItemId;\n      const lyricsAreEmpty =\n        lyrics?.lyrics?.plainLyrics === undefined &&\n        (lyrics?.lyrics?.syncedLyrics ?? undefined) === undefined;\n      if (lyrics === undefined || hasSongChanged || lyricsAreEmpty) {\n        // Only remove the current lyrics if they aren't empty for some reason (to keep the \"Trying again\" message)\n        if (!lyricsAreEmpty) {\n          setLyrics(undefined);\n        }\n\n        // Make replacements to track names to help better find lyrics\n        const trackNameWithReplacements = currentlyPlaying.currentlyPlayingObject.item.name\n          .replace(/ \\(feat.+\\)/i, \"\") // Remove (feat. ...)\n          .replace(/ \\(ft.+\\)/i, \"\") // Remove (ft. ...)\n          .replace(/ \\(with.+\\)/i, \"\") // Remove (with. ...)\n          .replace(/ - \\d{4} - Remaster/i, \"\") // Remove \"- 2021 - Remaster\"\n          .replace(/ - (\\d{4} )?Remaster(ed)?.*/i, \"\") // Remove \"- Remastered\" and \"- 2016 Remastered\" and \"- Remastered 2011\" and \" - 2016 Remaster\"\n          .replace(/ - Original Album Version/i, \"\") // Remove \"- Original Album Version\"\n          .replace(/ \\(Live\\)/i, \"\") // Remove \" (Live)\"\n          .replace(/ - Acoustic/i, \"\") // Remove \" - Acoustic\"\n          .replace(/ - from .*/i, \"\") // Remove \" - from ...\"\n          .replace(/ - Live from .*/i, \"\") // Remove \" - Live from ...\"\n          .replace(/ - Live/i, \"\") // Remove \" - Live\"\n          .replace(/ - \\d{4} Mix/i, \"\") // Remove \" - 2023 Mix\"\n          .trim();\n\n        // Get lyrics\n        const getLyricsPromiseCacheKey = JSON.stringify({\n          artists: currentlyPlaying.currentlyPlayingObject.item.artists.map(x => x.name),\n          title: trackNameWithReplacements,\n          album: currentlyPlaying.currentlyPlayingObject.item.album.name\n        });\n\n        const getLyricsPromise =\n          getLyricsPromiseCache[getLyricsPromiseCacheKey] ??\n          getLyrics(\n            currentlyPlaying.currentlyPlayingObject.item.artists.map(x => x.name),\n            trackNameWithReplacements,\n            currentlyPlaying.currentlyPlayingObject.item.album.name,\n            currentlyPlaying.currentlyPlayingObject.item.duration_ms\n          );\n        getLyricsPromiseCache[getLyricsPromiseCacheKey] = getLyricsPromise;\n\n        let didCancel = false;\n        const processPromise = async () => {\n          const getLyricsResult = await getLyricsPromise;\n\n          if (didCancel) {\n            return;\n          }\n\n          if (currentlyPlaying.currentlyPlayingObject.item !== null) {\n            setLyrics({\n              currentlyPlayingItemId: currentlyPlaying.currentlyPlayingObject.item.id,\n              lyrics: getLyricsResult ?? undefined\n            });\n          }\n        };\n        processPromise();\n        return () => {\n          didCancel = true;\n        };\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentlyPlaying]);\n\n  return lyrics;\n};\n\nexport default useLyrics;\n","import { IFoundLyrics, ITokenExpiryPair } from \"../../../src/dto\";\nimport Config from \"../config\";\n\nexport function getLyrics(\n  artists: string[],\n  title: string,\n  albumName: string,\n  duration: number\n): Promise<IFoundLyrics | null> {\n  const parameters = new URLSearchParams();\n  parameters.append(\"title\", title);\n  for (const artist of artists) {\n    parameters.append(\"artists\", artist);\n  }\n  parameters.append(\"albumName\", albumName);\n  parameters.append(\"duration\", duration.toString());\n\n  return fetch(`${Config.api.root}/api/lyrics?${parameters}`).then(r =>\n    r.status === 200 ? r.json() : null\n  );\n}\n\nexport function spotifyGetCurrentToken(): Promise<ITokenExpiryPair | null> {\n  return fetch(`${Config.api.root}/api/spotify/token`, {\n    credentials: \"include\"\n  }).then(r => {\n    if (r.status === 200) {\n      return r.json();\n    } else {\n      return null;\n    }\n  });\n}\n\nexport function spotifyRefreshToken(): Promise<ITokenExpiryPair | null> {\n  return fetch(`${Config.api.root}/api/spotify/refresh-token`, {\n    credentials: \"include\"\n  }).then(r => {\n    if (r.status === 200) {\n      return r.json();\n    } else {\n      return null;\n    }\n  });\n}\n\nexport function deleteSession(): Promise<Response> {\n  return fetch(`${Config.api.root}/api/session`, {\n    credentials: \"include\",\n    method: \"DELETE\"\n  });\n}\n","import green from \"@material-ui/core/colors/green\";\nimport { createMuiTheme } from \"@material-ui/core/styles\";\nimport { useEffect, useMemo, useState } from \"react\";\n\nconst localStorageKey = \"dark-theme\";\n\nconst useThemeState = () => {\n  const [darkMode, setDarkMode] = useState(false);\n  const theme = useMemo(() => getTheme(darkMode), [darkMode]);\n\n  // Pull current state out of local storage\n  useEffect(() => {\n    const rawState = localStorage.getItem(localStorageKey);\n    setDarkMode(rawState !== null);\n  }, []);\n\n  // Save to local storage while toggling\n  const toggleTheme = () =>\n    setDarkMode(m => {\n      const newState = !m;\n\n      if (newState) {\n        localStorage.setItem(localStorageKey, \"enabled\");\n      } else {\n        localStorage.removeItem(localStorageKey);\n      }\n\n      return newState;\n    });\n\n  return { theme, toggleTheme, darkModeEnabled: darkMode };\n};\n\nconst getTheme = (isDark: boolean) => {\n  if (isDark) {\n    return createMuiTheme({\n      palette: {\n        type: \"dark\",\n        primary: {\n          main: green[500]\n        }\n      }\n    });\n  } else {\n    return createMuiTheme({\n      palette: {\n        type: \"light\",\n        primary: {\n          main: green[800]\n        }\n      }\n    });\n  }\n};\n\nexport default useThemeState;\n","import cogoToast from \"cogo-toast\";\nimport { useEffect, useState } from \"react\";\nimport { spotifyRefreshToken } from \"../api\";\nimport { IToken } from \"../types/token\";\n\nconst useTokenRefresh = (\n  token: IToken | null,\n  onNewToken: (accessToken: string, expiresAt: number) => void,\n  clearToken: () => void\n) => {\n  const [tokenTimeout, setTokenTimeout] = useState<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    // Request for a new token before expiry\n    if (tokenTimeout !== null) {\n      clearTimeout(tokenTimeout);\n    }\n\n    if (token !== null) {\n      const timeToRefresh = token.expiry.getTime() - new Date().getTime() - 60 * 1000; // (future - now) - 1min\n      setTokenTimeout(\n        setTimeout(() => {\n          spotifyRefreshToken().then(newToken => {\n            if (newToken !== null) {\n              onNewToken(newToken.access_token, newToken.expires_at);\n            } else {\n              const { hide } = cogoToast.warn(\n                \"Unable to keep logged into Spotify. Please log back in.\",\n                {\n                  position: \"bottom-center\",\n                  heading: \"Spotify Login Expired\",\n                  hideAfter: 20,\n                  onClick: () => hide !== undefined && hide()\n                }\n              );\n              clearToken();\n            }\n          });\n        }, timeToRefresh)\n      );\n    }\n\n    return () => {\n      if (tokenTimeout !== null) {\n        clearTimeout(tokenTimeout);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [token]);\n};\n\nexport default useTokenRefresh;\n","import cogoToast from \"cogo-toast\";\nimport { useEffect, useState } from \"react\";\nimport SpotifyWebApi from \"spotify-web-api-js\";\nimport { IToken } from \"../types/token\";\n\nconst useUser = (token: IToken | null, clearToken: () => void) => {\n  const [user, setUser] = useState<SpotifyApi.UserObjectPrivate | null>(null);\n\n  // Request the user when the token changes\n  useEffect(() => {\n    if (token === null) {\n      setUser(null);\n    } else {\n      const spotifyApi = new SpotifyWebApi();\n      spotifyApi.setAccessToken(token.value);\n      spotifyApi\n        .getMe()\n        .then(newUser => setUser(newUser))\n        .catch(err => {\n          console.error(err);\n          const { hide } = cogoToast.error(\n            \"Could not get your profile. Make sure you are connected to the internet and that cookies are allowed.\",\n            {\n              position: \"bottom-center\",\n              heading: \"Error When Fetching Your Profile\",\n              hideAfter: 20,\n              onClick: () => hide !== undefined && hide()\n            }\n          );\n        });\n    }\n  }, [token]);\n\n  return user;\n};\n\nexport default useUser;\n","import { Box, Link, Typography } from \"@material-ui/core\";\nimport React from \"react\";\n\nconst About: React.FC = () => {\n  return (\n    <div style={{ maxWidth: 600, margin: \"auto\" }}>\n      <Typography variant=\"h4\" align=\"center\" gutterBottom>\n        About\n      </Typography>\n\n      <Typography gutterBottom>\n        Spotify Lyrics Viewer is a tool that allows you to view the lyrics of the current playing\n        song on Spotify.\n      </Typography>\n      <Typography gutterBottom>\n        To do this, we first log you into Spotify so we can see the current song playing. The title\n        and artist are then used to try and find the lyrics on{\" \"}\n        <Link href=\"https://genius.com/\">GENIUS</Link> and whatever lyrics matched the best are\n        displayed to you.\n      </Typography>\n      <Typography gutterBottom>\n        Please note that the lyrics returned may not be for the current playing song in some\n        situations due the the lyrics not existing on GENIUS or the fact that the current playing\n        songs title has some extra content to it aside from the actual title.\n      </Typography>\n\n      <Box mt={3}>\n        <Typography align=\"center\">\n          <Link href=\"https://github.com/brentvollebregt/spotify-lyrics-viewer\">Source</Link>\n          {\"  \"}\n          <Link href=\"https://github.com/brentvollebregt\">Brent Vollebregt</Link>\n          {\"  \"}\n          <Link href=\"https://nitratine.net/\">Nitratine.net</Link>\n        </Typography>\n      </Box>\n    </div>\n  );\n};\n\nexport default About;\n","import { Box, Typography } from \"@material-ui/core\";\nimport React from \"react\";\n\nconst Advertisement: React.FC = () => {\n  return (\n    <Box textAlign=\"center\">\n      <Typography variant=\"h4\" gutterBottom>\n        Waiting for an ad\n      </Typography>\n    </Box>\n  );\n};\n\nexport default Advertisement;\n","import { Box, Typography } from \"@material-ui/core\";\nimport React from \"react\";\n\nconst Error: React.FunctionComponent = () => {\n  return (\n    <Box textAlign=\"center\">\n      <Typography variant=\"h4\" gutterBottom>\n        Error\n      </Typography>\n\n      <Typography>An unexpected error ocurred</Typography>\n    </Box>\n  );\n};\n\nexport default Error;\n","import { Box, CircularProgress, Typography } from \"@material-ui/core\";\nimport React from \"react\";\n\nconst Loading: React.FunctionComponent = () => {\n  return (\n    <Box textAlign=\"center\">\n      <Typography variant=\"h4\" gutterBottom>\n        Loading...\n      </Typography>\n\n      <Typography gutterBottom>\n        To get access to your current playing song, you need to sign into Spotify.\n      </Typography>\n\n      <CircularProgress size={30} />\n    </Box>\n  );\n};\n\nexport default Loading;\n","import { Box, Typography } from \"@material-ui/core\";\nimport React from \"react\";\n\nconst NoTrackPlaying: React.FunctionComponent = () => {\n  return (\n    <Box textAlign=\"center\">\n      <Typography variant=\"h4\" gutterBottom>\n        No Song is Playing\n      </Typography>\n\n      <Typography>\n        A song must be playing on Spotify for lyrics to be displayed.\n        <br />\n        Also make sure you are not using a private session.\n      </Typography>\n    </Box>\n  );\n};\n\nexport default NoTrackPlaying;\n","import {\n  Box,\n  IconButton,\n  InputAdornment,\n  Link,\n  TextField,\n  Toolbar,\n  Typography,\n  makeStyles\n} from \"@material-ui/core\";\nimport CloseIcon from \"@material-ui/icons/Close\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport SyncEnabledIcon from \"@material-ui/icons/Sync\";\nimport SyncDisabledIcon from \"@material-ui/icons/SyncDisabled\";\nimport MarkJS from \"mark.js\";\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { IFoundLyrics } from \"../../../../src/dto\";\nimport useSmoothProgress from \"../../hooks/useSmoothProgress\";\nimport \"./LyricsDisplay.css\";\n\ninterface IProps {\n  lyricsDetails: IFoundLyrics;\n  progressMs: number;\n  paused: boolean;\n}\n\nconst LyricsDisplay: React.FunctionComponent<IProps> = ({ lyricsDetails, progressMs, paused }) => {\n  const classes = useStyles();\n  const lyricsRef = useRef<HTMLDivElement | null>(null);\n  const searchInputRef = useRef<HTMLInputElement | null>(null);\n  const highlightedRef = useRef<HTMLSpanElement | null>(null);\n  const [search, setSearch] = useState(\"\");\n  const [searchShown, setSearchShown] = useState(false);\n  const [syncEnabled, setSyncEnabled] = useState(true);\n\n  const { progress: smoothedProgressMs } = useSmoothProgress(\n    progressMs,\n    Infinity,\n    !paused,\n    null,\n    250\n  );\n\n  const isSyncingPossible = lyricsDetails.syncedLyrics !== null;\n\n  // Highlight text when the search is changed\n  useEffect(() => {\n    if (lyricsRef.current !== null) {\n      const instance = new MarkJS(lyricsRef.current);\n      instance.unmark();\n      if (search !== \"\") {\n        instance.mark(search);\n      }\n    }\n  }, [search, lyricsDetails]);\n\n  // Focus search input when the search button is clicked\n  useEffect(() => {\n    if (searchShown && searchInputRef.current !== null) {\n      searchInputRef.current.focus();\n    }\n  }, [searchShown]);\n\n  // Automatically scroll to highlighted text\n  useEffect(() => {\n    const element = highlightedRef.current;\n    if (syncEnabled && element !== null) {\n      element.scrollIntoView({ behavior: \"smooth\", block: \"center\", inline: \"nearest\" });\n    }\n  }, [syncEnabled, smoothedProgressMs]);\n\n  const lyricsState = useMemo(\n    () => calculateLyricsState(lyricsDetails, smoothedProgressMs, syncEnabled, paused),\n    [lyricsDetails, smoothedProgressMs, syncEnabled, paused]\n  );\n\n  const onUserSearch = (event: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) =>\n    setSearch(event.currentTarget.value ?? \"\");\n  const toggleSearchShown = () => setSearchShown(s => !s);\n  const toggleSyncEnabled = () => setSyncEnabled(s => !s);\n\n  return (\n    <div className={classes.root}>\n      <Toolbar className={classes.toolbar}>\n        {searchShown ? (\n          <Box mb={1}>\n            <TextField\n              variant=\"outlined\"\n              value={search}\n              onChange={onUserSearch}\n              InputProps={{\n                endAdornment: (\n                  <InputAdornment position=\"end\">\n                    <IconButton onClick={toggleSearchShown} edge=\"end\">\n                      <CloseIcon />\n                    </IconButton>\n                  </InputAdornment>\n                )\n              }}\n              label=\"Search\"\n              placeholder=\"Search lyrics you heard to find your position...\"\n              style={{ width: \"100%\", maxWidth: 600 }}\n            />\n          </Box>\n        ) : (\n          <IconButton onClick={toggleSearchShown}>\n            <SearchIcon fontSize=\"small\" />\n          </IconButton>\n        )}\n        <IconButton onClick={toggleSyncEnabled} disabled={!isSyncingPossible}>\n          {syncEnabled ? <SyncEnabledIcon /> : <SyncDisabledIcon />}\n        </IconButton>\n      </Toolbar>\n      <div>\n        <Typography component=\"div\" className={classes.lyrics} ref={lyricsRef} id=\"lyrics-main\">\n          <span id=\"lyrics-passed\">{lyricsState.before}</span>\n\n          {lyricsState.highlighted !== \"\" && (\n            <div className={classes.highlightedLyricsWrapper}>\n              <span className={classes.highlightedLyrics} ref={highlightedRef} id=\"lyrics-current\">\n                {lyricsState.highlighted}\n              </span>\n            </div>\n          )}\n\n          <span id=\"lyrics-upcoming\">{lyricsState.after}</span>\n        </Typography>\n        <Box mt={2} textAlign=\"left\">\n          <Typography id=\"lyrics-provider\">\n            <Link href={lyricsDetails.attribution}>\n              Lyrics for {lyricsDetails.title} by {lyricsDetails.artist}\n            </Link>\n          </Typography>\n        </Box>\n      </div>\n    </div>\n  );\n};\n\nconst calculateLyricsState = (\n  lyricsDetails: IFoundLyrics,\n  progressMs: number,\n  syncEnabled: boolean,\n  paused: boolean\n) => {\n  const progressSeconds = progressMs / 1000;\n\n  // If there is no syncedLyricsArray or sync is disabled or the song is paused, return the plain lyrics\n  if (lyricsDetails.syncedLyrics === null || !syncEnabled || paused) {\n    return {\n      before: \"\",\n      highlighted: \"\",\n      after: lyricsDetails.plainLyrics ?? \"\"\n    };\n  }\n\n  // Calculate the current lyric state based on progress\n  const passedLyricsAndCurrent =\n    lyricsDetails.syncedLyrics.filter(x => x.timestamp <= progressSeconds) ?? [];\n  const passedLyrics = passedLyricsAndCurrent.slice(0, -1);\n  const currentLyrics =\n    passedLyricsAndCurrent.length > 0\n      ? passedLyricsAndCurrent[passedLyricsAndCurrent.length - 1]\n      : null;\n  const upcomingLyrics = lyricsDetails.syncedLyrics.filter(x => x.timestamp > progressSeconds);\n\n  return {\n    before: passedLyrics.map(x => x.content).join(\" \\n \"),\n    highlighted: currentLyrics?.content ?? \"\",\n    after: upcomingLyrics.map(x => x.content).join(\" \\n \")\n  };\n};\n\nconst useStyles = makeStyles(theme => ({\n  lyrics: {\n    whiteSpace: \"pre-wrap\"\n  },\n  highlightedLyricsWrapper: {\n    marginTop: 20,\n    marginBottom: 20\n  },\n  highlightedLyrics: {\n    padding: \"0.1em 0\",\n    whiteSpace: \"pre-wrap\",\n    fontWeight: \"bolder\",\n    fontSize: \"5em\",\n    [theme.breakpoints.down(\"xs\")]: {\n      fontSize: \"3em\"\n    }\n  },\n  root: {\n    margin: \"auto\",\n    maxWidth: 700,\n    position: \"relative\",\n    textAlign: \"center\"\n  },\n  toolbar: {\n    padding: 0,\n    margin: \"-6px -6px 0 0\",\n    position: \"fixed\",\n    right: 60,\n    top: 75\n  }\n}));\n\nexport default LyricsDisplay;\n","import { Box, CircularProgress, Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { PlayingStatePaused, PlayingStatePlaying } from \"../../types/currentlyPlayingState\";\nimport { ITrackLyrics } from \"../../types/trackLyrics\";\nimport LyricsDisplay from \"./LyricsDisplay\";\n\ninterface IProps {\n  lyricDetails?: ITrackLyrics;\n  currentlyPlayingSong?: PlayingStatePlaying | PlayingStatePaused;\n}\n\nconst TrackPlaying: React.FunctionComponent<IProps> = ({ lyricDetails, currentlyPlayingSong }) => {\n  // No lyrics yet\n  if (lyricDetails === undefined) {\n    return (\n      <Box textAlign=\"center\">\n        <CircularProgress size={30} />\n      </Box>\n    );\n  }\n\n  // No lyrics found\n  if (lyricDetails.lyrics === undefined) {\n    return (\n      <Box textAlign=\"center\">\n        <Typography>No lyrics found for the current track.</Typography>\n      </Box>\n    );\n  }\n\n  // Lyrics miss\n  const lyricsAreEmpty =\n    lyricDetails?.lyrics?.plainLyrics === undefined &&\n    (lyricDetails?.lyrics?.syncedLyrics ?? undefined) === undefined;\n  if (lyricsAreEmpty) {\n    return (\n      <Box textAlign=\"center\">\n        <Typography>No lyrics found. Trying again.</Typography>\n        <Box mt={1}>\n          <CircularProgress size={30} />\n        </Box>\n      </Box>\n    );\n  }\n\n  // Lyrics found\n  return (\n    <LyricsDisplay\n      lyricsDetails={lyricDetails.lyrics}\n      progressMs={currentlyPlayingSong?.currentlyPlayingObject?.progress_ms ?? 0}\n      paused={!currentlyPlayingSong?.currentlyPlayingObject?.is_playing ?? false}\n    />\n  );\n};\n\nexport default TrackPlaying;\n","import { Avatar, Box, Button, Typography } from \"@material-ui/core\";\nimport { navigate } from \"hookrouter\";\nimport React from \"react\";\nimport SpotifyLogoRoundImage from \"../../img/spotify-logo-round.png\";\n\nconst Welcome: React.FunctionComponent = () => {\n  const onLoginButtonClicked = () => {\n    navigate(\"/spotify-authorization\");\n  };\n\n  return (\n    <Box textAlign=\"center\">\n      <Typography variant=\"h4\" gutterBottom>\n        Spotify Lyrics Viewer\n      </Typography>\n\n      <Typography gutterBottom>\n        To get access to your current playing song, you need to sign into Spotify.\n      </Typography>\n\n      <Button\n        variant=\"outlined\"\n        color=\"primary\"\n        onClick={onLoginButtonClicked}\n        startIcon={\n          <Avatar\n            src={SpotifyLogoRoundImage}\n            alt=\"Spotify Logo Round\"\n            style={{ width: 20, height: 20 }}\n          />\n        }\n      >\n        Sign In With Spotify\n      </Button>\n    </Box>\n  );\n};\n\nexport default Welcome;\n","import React from \"react\";\nimport { CurrentlyPlayingState, PlayingStates } from \"../../types/currentlyPlayingState\";\nimport { ITrackLyrics } from \"../../types/trackLyrics\";\nimport Advertisement from \"./Advertisement\";\nimport Error from \"./Error\";\nimport Loading from \"./Loading\";\nimport NoTrackPlaying from \"./NoTrackPlaying\";\nimport TrackPlaying from \"./TrackPlaying\";\nimport Welcome from \"./Welcome\";\n\ninterface IProps {\n  user: SpotifyApi.UserObjectPrivate | null;\n  currentlyPlayingSong: CurrentlyPlayingState;\n  lyrics: ITrackLyrics | undefined;\n}\n\nconst LyricsView: React.FunctionComponent<IProps> = ({ user, currentlyPlayingSong, lyrics }) => {\n  if (user === null) {\n    return <Welcome />;\n  } else if (currentlyPlayingSong.state === PlayingStates.Loading) {\n    return <Loading />;\n  } else if (currentlyPlayingSong.state === PlayingStates.NotPlaying) {\n    return <NoTrackPlaying />;\n  } else if (currentlyPlayingSong.state === PlayingStates.Error) {\n    return <Error />;\n  } else if (currentlyPlayingSong.currentlyPlayingObject.currently_playing_type === \"ad\") {\n    return <Advertisement />;\n  } else {\n    return <TrackPlaying lyricDetails={lyrics} currentlyPlayingSong={currentlyPlayingSong} />;\n  }\n};\n\nexport default LyricsView;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\n\nconst NotFound: React.FC = () => {\n  return (\n    <Typography variant=\"h4\" align=\"center\">\n      Page Not Found\n    </Typography>\n  );\n};\n\nexport default NotFound;\n","import { Box, CircularProgress, Typography } from \"@material-ui/core\";\nimport { navigate } from \"hookrouter\";\nimport React from \"react\";\nimport Config from \"../../config\";\n\ninterface IProps {\n  onNewToken: (accessToken: string, expiresIn: number) => void;\n}\n\nconst SpotifyAuthorization: React.FC<IProps> = ({ onNewToken }) => {\n  const { search } = window.location;\n\n  let message = <></>;\n\n  if (search === \"\") {\n    // No token in URL, redirect user to request for one\n    window.location.href = Config.api.root + Config.api.spotify_authentication_route;\n    message = (\n      <>\n        <Box mb={2}>\n          <Typography variant=\"subtitle1\">Redirecting</Typography>\n        </Box>\n        <CircularProgress size={30} />\n      </>\n    );\n  } else {\n    // We have received the token, read it from the URL\n    const params = new URLSearchParams(search.substr(1));\n    const accessToken = params.get(\"access_token\");\n    const expiresAt = params.get(\"expires_at\");\n\n    if (accessToken !== null && expiresAt !== null) {\n      // All parameters are present\n      onNewToken(accessToken, parseInt(expiresAt, 10));\n      navigate(\"/\");\n      message = <Typography variant=\"subtitle1\">Token received</Typography>;\n    } else {\n      message = <Typography variant=\"subtitle1\">Incorrect URL parameters</Typography>;\n    }\n  }\n\n  return (\n    <>\n      <Typography variant=\"h4\" align=\"center\">\n        Spotify Authorization\n      </Typography>\n      <Box alignItems=\"center\" textAlign=\"center\">\n        {message}\n      </Box>\n    </>\n  );\n};\n\nexport default SpotifyAuthorization;\n","import { Box, Container, CssBaseline, ThemeProvider } from \"@material-ui/core\";\nimport { setBasepath, useRedirect, useRoutes } from \"hookrouter\";\nimport React, { useEffect, useState } from \"react\";\nimport { deleteSession, spotifyGetCurrentToken } from \"./api\";\nimport MetaTags from \"./components/MetaTags\";\nimport Navigation from \"./components/Navigation\";\nimport Player from \"./components/Player\";\nimport config from \"./config\";\nimport useCurrentlyPlayingSong from \"./hooks/useCurrentlyPlayingSong\";\nimport useLyrics from \"./hooks/useLyrics\";\nimport useThemeState from \"./hooks/useThemeState\";\nimport useTokenRefresh from \"./hooks/useTokenRefresh\";\nimport useUser from \"./hooks/useUser\";\nimport About from \"./pages/About\";\nimport LyricsView from \"./pages/LyricsView\";\nimport NotFound from \"./pages/NotFound\";\nimport SpotifyAuthorization from \"./pages/SpotifyAuthorization\";\nimport { IToken } from \"./types/token\";\n\nconst App: React.FC = () => {\n  const [token, setToken] = useState<IToken | null>(null);\n\n  const onNewToken = (accessToken: string, expiresAt: number) => {\n    setToken({ expiry: new Date(expiresAt), value: accessToken } as IToken);\n  };\n  const clearToken = () => {\n    setToken(null);\n    deleteSession();\n  };\n\n  if (config.client.basename !== undefined) {\n    // Needed when we have a subdirectory in the url to adjust the links on home, about, etc\n    setBasepath(config.client.basename);\n  }\n\n  const user = useUser(token, clearToken);\n  useTokenRefresh(token, onNewToken, clearToken);\n  const currentlyPlayingSong = useCurrentlyPlayingSong(token, clearToken);\n  const lyrics = useLyrics(currentlyPlayingSong);\n  const { theme, toggleTheme, darkModeEnabled } = useThemeState();\n\n  // Request for a token on load to see if data is already in the state\n  useEffect(() => {\n    spotifyGetCurrentToken().then(newToken => {\n      if (newToken !== null) {\n        onNewToken(newToken.access_token, newToken.expires_at);\n      }\n    });\n  }, []);\n\n  const routes = {\n    \"/\": () => (\n      <MetaTags\n        route=\"/\"\n        description=\"View the lyrics of the current song playing on your Spotify account in your browser.\"\n      >\n        <LyricsView user={user} currentlyPlayingSong={currentlyPlayingSong} lyrics={lyrics} />\n      </MetaTags>\n    ),\n    \"/about\": () => (\n      <MetaTags\n        route=\"/about\"\n        titlePrefix=\"About - \"\n        description=\"Spotify Lyrics Viewer is a tool that allows you to view the lyrics of the current playing song on Spotify.\"\n      >\n        <About />\n      </MetaTags>\n    ),\n    \"/spotify-authorization\": () => <SpotifyAuthorization onNewToken={onNewToken} />,\n    \"/spotify-authorization/\": () => <SpotifyAuthorization onNewToken={onNewToken} />\n  };\n  const routeResult = useRoutes(routes);\n  useRedirect(\"/about/\", \"/about\");\n\n  return (\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <div style={{ display: \"grid\", gridTemplateRows: \"auto 1fr auto\", height: \"100%\" }}>\n        <Navigation\n          user={user}\n          onLogout={clearToken}\n          onThemeToggle={toggleTheme}\n          isDarkMode={darkModeEnabled}\n        />\n\n        <Box py={3} style={{ overflow: \"auto\" }}>\n          <Container maxWidth=\"md\">{routeResult ?? <NotFound />}</Container>\n        </Box>\n\n        <Player currentlyPlayingSong={currentlyPlayingSong} token={token} />\n      </div>\n    </ThemeProvider>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}